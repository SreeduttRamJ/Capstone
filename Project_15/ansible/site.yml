
---

- name: Install and start a web server

  hosts: web

  become: yes

  vars:

    # Default to nginx on Debian/Ubuntu, httpd on RHEL/CentOS

    deb_pkg: nginx

    deb_svc: nginx

    rhel_pkg: httpd

    rhel_svc: httpd



  tasks:

    - name: Detect OS family

        # Facts are autoâ€‘gathered by default; if you disable, add: gather_facts: yes

      debug:

        msg: "OS Family = {{ ansible_facts.os_family }}"



    - name: Install web server on Debian/Ubuntu

      apt:

        name: "{{ deb_pkg }}"

        state: present

        update_cache: yes

      when: ansible_facts.os_family == "Debian"



    - name: Install web server on RHEL/CentOS

      package:

        name: "{{ rhel_pkg }}"

        state: present

      when: ansible_facts.os_family == "RedHat"



    - name: Copy home page for nginx (Debian/Ubuntu)

      copy:

        src: index.html

        dest: /var/www/html/index.html

        owner: www-data

        group: www-data

        mode: '0644'

      when: ansible_facts.os_family == "Debian"



    - name: Copy home page for httpd (RHEL/CentOS)

      copy:

        src: index.html

        dest: /var/www/html/index.html

        owner: apache

        group: apache

        mode: '0644'

      when: ansible_facts.os_family == "RedHat"



    - name: Ensure service is enabled and running (Debian/Ubuntu)

      service:

        name: "{{ deb_svc }}"

        state: started

        enabled: yes

      when: ansible_facts.os_family == "Debian"



    - name: Ensure service is enabled and running (RHEL/CentOS)

      service:

        name: "{{ rhel_svc }}"

        state: started

        enabled: yes

      when: ansible_facts.os_family == "RedHat"

